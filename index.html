<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotizador NEMOC</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #003366; }
    label { display:block; margin-top:10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 6px; margin-top:4px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
    button { margin-top: 15px; padding: 10px 15px; background:#003366; color:white; border:none; cursor:pointer; border-radius:5px; }
    button:hover { background:#0055aa; }
  </style>
</head>
<body>
  <h2>üìÑ Generador de Cotizaciones - NEMOC Multiservicios Ingenier√≠a y Tecnolog√≠a</h2>

  <!-- Datos del cliente -->
  <label>Cliente:</label><input type="text" id="cliente">
  <label>Empresa:</label><input type="text" id="empresa">
  <label>NIT:</label><input type="text" id="nit">
  <label>Tel√©fono:</label><input type="text" id="telefono">
  <label>Correo:</label><input type="email" id="correo">
  <label>Direcci√≥n:</label><input type="text" id="direccion">

  <!-- IVA editable -->
  <label>% IVA:</label><input type="number" id="iva" value="19">

  <!-- Condiciones -->
  <label>Condiciones comerciales:</label>
  <textarea id="condiciones">Tiempo de entrega: inmediato. Forma de pago: transferencia bancaria. Validez: 15 d√≠as.</textarea>

  <!-- Tabla de √≠tems -->
  <table id="items">
    <thead>
      <tr>
        <th>Cantidad</th>
        <th>Descripci√≥n</th>
        <th>Valor Unitario</th>
        <th>Total</th>
        <th>Acci√≥n</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="agregarItem()">‚ûï Agregar √çtem</button>
  <button onclick="generarPDF()">üìë Generar PDF</button>

  <script>
    const { jsPDF } = window.jspdf;

    function agregarItem() {
      let tabla = document.querySelector("#items tbody");
      let fila = document.createElement("tr");
      fila.innerHTML = `
        <td><input type="number" value="1" onchange="actualizarTotal(this)"></td>
        <td><input type="text" placeholder="Descripci√≥n"></td>
        <td><input type="number" value="0" onchange="actualizarTotal(this)"></td>
        <td class="total">0</td>
        <td><button onclick="this.parentElement.parentElement.remove()">‚ùå</button></td>
      `;
      tabla.appendChild(fila);
    }

    function actualizarTotal(el) {
      let fila = el.closest("tr");
      let cantidad = fila.children[0].children[0].value;
      let unitario = fila.children[2].children[0].value;
      fila.querySelector(".total").textContent = (cantidad * unitario).toFixed(2);
    }

    function generarPDF() {
      let doc = new jsPDF();

      // Logo (base64 incrustado si quieres fijo, aqu√≠ ejemplo con rect√°ngulo de marca)
      doc.setFillColor(0, 51, 102);
      doc.rect(10, 10, 190, 20, "F");
      doc.setTextColor(255,255,255);
      doc.setFontSize(16);
      doc.text("NEMOC Multiservicios Ingenier√≠a y Tecnolog√≠a", 15, 25);

      doc.setTextColor(0,0,0);
      doc.setFontSize(12);
      let fecha = new Date().toLocaleDateString();
      doc.text(`Fecha: ${fecha}`, 150, 40);

      // Datos del cliente
      doc.setFontSize(11);
      doc.text(`Cliente: ${document.getElementById("cliente").value}`, 15, 50);
      doc.text(`Empresa: ${document.getElementById("empresa").value}`, 15, 56);
      doc.text(`NIT: ${document.getElementById("nit").value}`, 15, 62);
      doc.text(`Tel√©fono: ${document.getElementById("telefono").value}`, 15, 68);
      doc.text(`Correo: ${document.getElementById("correo").value}`, 15, 74);
      doc.text(`Direcci√≥n: ${document.getElementById("direccion").value}`, 15, 80);

      // Tabla de √≠tems
      let filas = [];
      document.querySelectorAll("#items tbody tr").forEach(tr => {
        let cantidad = tr.children[0].children[0].value;
        let desc = tr.children[1].children[0].value;
        let unitario = tr.children[2].children[0].value;
        let total = tr.children[3].textContent;
        filas.push([cantidad, desc, unitario, total]);
      });

      doc.autoTable({
        startY: 90,
        head: [['Cantidad','Descripci√≥n','Unitario','Total']],
        body: filas
      });

      // Calcular totales
      let subtotal = filas.reduce((sum, row) => sum + parseFloat(row[3]||0), 0);
      let iva = parseFloat(document.getElementById("iva").value) || 0;
      let ivaValor = subtotal * (iva/100);
      let total = subtotal + ivaValor;

      let posY = doc.lastAutoTable.finalY + 10;
      doc.text(`Subtotal: $${subtotal.toFixed(2)}`, 140, posY);
      doc.text(`IVA (${iva}%): $${ivaValor.toFixed(2)}`, 140, posY+6);
      doc.text(`TOTAL: $${total.toFixed(2)}`, 140, posY+12);

      // Condiciones
      doc.setFontSize(10);
      doc.text("Condiciones comerciales:", 15, posY+20);
      doc.text(doc.splitTextToSize(document.getElementById("condiciones").value, 180), 15, posY+26);

      // Pie de p√°gina
      doc.setFontSize(9);
      doc.text("NEMOC Multiservicios Ingenier√≠a y Tecnolog√≠a", 15, 280);
      doc.text("Tel: 3185621097 - Email: nemoca1004@gmail.com", 15, 286);
      doc.text("Calle 45 # 35-36, Barrio L√≠bano, Santa Marta", 15, 292);

      doc.save("cotizacion_nemoc.pdf");
    }
  </script>
</body>
</html>
