<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cotizador NEMOC</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #005baa; }
    label { display:block; margin-top:10px; font-weight: bold; }
    input, textarea { width:100%; padding:5px; margin-top:4px; }
    table { width:100%; border-collapse: collapse; margin-top:20px; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:8px; text-align:center; }
    .btn { margin-top:20px; padding:10px 15px; background:#005baa; color:#fff; border:none; cursor:pointer; border-radius:5px; }
  </style>
</head>
<body>
  <h1>Cotizador - NEMOC Multiservicios Ingenier√≠a y Tecnolog√≠a</h1>

  <h3>Datos del Cliente</h3>
  <label>Nombre:</label><input id="clienteNombre">
  <label>Empresa:</label><input id="clienteEmpresa">
  <label>NIT:</label><input id="clienteNIT">
  <label>Tel√©fono:</label><input id="clienteTelefono">
  <label>Correo:</label><input id="clienteCorreo">
  <label>Direcci√≥n:</label><input id="clienteDireccion">

  <h3>Items de Cotizaci√≥n</h3>
  <table id="tablaItems">
    <thead>
      <tr><th>Cant.</th><th>Descripci√≥n</th><th>V. Unitario</th><th>Subtotal</th><th>Acci√≥n</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="agregarItem()">‚ûï Agregar √çtem</button>

  <h3>Condiciones Comerciales</h3>
  <textarea id="condiciones" rows="4">1. Precios en COP.
2. IVA no incluido.
3. Tiempo de entrega: 15 d√≠as h√°biles.
4. Garant√≠a: 12 meses.</textarea>

  <h3>Impuestos</h3>
  <label>IVA (%):</label>
  <input id="iva" type="number" value="19">

  <button class="btn" onclick="generarPDF()">Generar PDF</button>

<script>
let { jsPDF } = window.jspdf;

// Logo en Base64 (tu imagen ya convertida a base64)
const logoBase64 = ""; // üëâ aqu√≠ debo pegar tu logo convertido a base64

function agregarItem() {
  let tabla = document.getElementById("tablaItems").querySelector("tbody");
  let fila = tabla.insertRow();
  fila.innerHTML = `
    <td><input type="number" value="1" onchange="actualizarSubtotal(this)"></td>
    <td><input type="text" placeholder="Descripci√≥n"></td>
    <td><input type="number" value="0" onchange="actualizarSubtotal(this)"></td>
    <td class="subtotal">0</td>
    <td><button onclick="eliminarFila(this)">‚ùå</button></td>
  `;
}

function eliminarFila(btn) {
  btn.parentElement.parentElement.remove();
}

function actualizarSubtotal(input) {
  let fila = input.parentElement.parentElement;
  let cantidad = parseFloat(fila.cells[0].querySelector("input").value) || 0;
  let valor = parseFloat(fila.cells[2].querySelector("input").value) || 0;
  fila.querySelector(".subtotal").innerText = (cantidad * valor).toFixed(2);
}

function generarPDF() {
  let doc = new jsPDF();

  // Logo
  if (logoBase64) {
    doc.addImage(logoBase64, "PNG", 10, 10, 40, 20);
  }

  doc.setFontSize(12);
  doc.text("NEMOC Multiservicios Ingenier√≠a y Tecnolog√≠a", 60, 20);
  doc.text("Tel: 3185621097 | Email: nemoca1004@gmail.com", 60, 27);
  doc.text("Calle 45 #35-36 Barrio L√≠bano, Santa Marta", 60, 34);

  doc.setFontSize(14);
  doc.text("Cotizaci√≥n", 105, 50, null, null, "center");

  // Datos cliente
  let cliente = [
    ["Nombre:", document.getElementById("clienteNombre").value],
    ["Empresa:", document.getElementById("clienteEmpresa").value],
    ["NIT:", document.getElementById("clienteNIT").value],
    ["Tel√©fono:", document.getElementById("clienteTelefono").value],
    ["Correo:", document.getElementById("clienteCorreo").value],
    ["Direcci√≥n:", document.getElementById("clienteDireccion").value]
  ];
  doc.autoTable({ startY: 60, body: cliente, theme:"plain" });

  // Items
  let items = [];
  let filas = document.getElementById("tablaItems").querySelector("tbody").rows;
  let subtotal = 0;
  for (let f of filas) {
    let cant = f.cells[0].querySelector("input").value;
    let desc = f.cells[1].querySelector("input").value;
    let unit = f.cells[2].querySelector("input").value;
    let sub = parseFloat(f.cells[3].innerText) || 0;
    subtotal += sub;
    items.push([cant, desc, unit, sub.toFixed(2)]);
  }

  doc.autoTable({
    head:[["Cant.","Descripci√≥n","V. Unitario","Subtotal"]],
    body: items,
    startY: doc.lastAutoTable.finalY + 10
  });

  // Totales
  let iva = parseFloat(document.getElementById("iva").value) || 0;
  let valorIVA = subtotal * iva / 100;
  let total = subtotal + valorIVA;

  doc.autoTable({
    body:[
      ["Subtotal", subtotal.toFixed(2)],
      ["IVA ("+iva+"%)", valorIVA.toFixed(2)],
      ["TOTAL", total.toFixed(2)]
    ],
    startY: doc.lastAutoTable.finalY + 5,
    theme:"plain"
  });

  // Condiciones
  doc.setFontSize(11);
  doc.text("Condiciones Comerciales:", 14, doc.lastAutoTable.finalY + 20);
  doc.text(document.getElementById("condiciones").value, 14, doc.lastAutoTable.finalY + 28);

  // Pie
  doc.setFontSize(10);
  doc.text("NEMOC Ingenier√≠a y Tecnolog√≠a - Multiservicios Integrales", 105, 290, null, null, "center");

  doc.save("Cotizacion_NEMOC.pdf");
}
</script>
</body>
</html>
