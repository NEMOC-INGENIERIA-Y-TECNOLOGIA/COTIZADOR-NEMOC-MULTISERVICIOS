<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cotizador NEMOC Ingenier√≠a y Tecnolog√≠a</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="logo_nemoc_base64.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
    input { width: 100%; border: none; text-align: center; }
    .btn { padding: 8px 12px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; }
    .btn-add { background: #28a745; color: white; }
    .btn-del { background: #dc3545; color: white; }
    .btn-clear { background: #ffc107; color: black; }
    .totales { text-align: right; margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Cotizaci√≥n - NEMOC Ingenier√≠a y Tecnolog√≠a</h1>

  <h3>Datos del Cliente</h3>
  <label>Nombre/Empresa: <input id="cliente_nombre" /></label><br />
  <label>NIT: <input id="cliente_nit" /></label><br />
  <label>Tel√©fono: <input id="cliente_tel" /></label><br />
  <label>Correo: <input id="cliente_correo" /></label><br />

  <h3>√çtems</h3>
  <table id="tablaItems">
    <thead>
      <tr>
        <th>Cantidad</th>
        <th>Descripci√≥n</th>
        <th>Valor Unitario</th>
        <th>Total</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button class="btn btn-add" onclick="agregarFila()">‚ûï Agregar √çtem</button>
  <button class="btn btn-clear" onclick="limpiarTabla()">üóëÔ∏è Limpiar √çtems</button>

  <div class="totales">
    Subtotal: <span id="subtotal">0</span><br />
    IVA (%): <input id="iva" type="number" value="19" style="width:60px;text-align:right;" oninput="calcularTotales()"/> %<br />
    Total: <span id="total">0</span>
  </div>

  <h3>Condiciones</h3>
  <textarea id="condiciones" rows="5" style="width:100%;">V√°lida por 30 d√≠as. Pago 50% inicial y 50% contraentrega.</textarea>

  <button class="btn btn-add" onclick="generarPDF()">üìÑ Generar PDF</button>

  <script>
    function formatoCOP(valor) {
      return new Intl.NumberFormat("es-CO", { style: "currency", currency: "COP" }).format(valor);
    }

    function agregarFila() {
      const tabla = document.getElementById("tablaItems").querySelector("tbody");
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td><input type="number" value="1" oninput="calcularTotales()" /></td>
        <td><input type="text" placeholder="Descripci√≥n" oninput="calcularTotales()"/></td>
        <td><input type="number" value="0" oninput="calcularTotales()"/></td>
        <td class="totalFila">0</td>
        <td><button class="btn btn-del" onclick="this.parentElement.parentElement.remove(); calcularTotales();">‚ùå</button></td>
      `;
      tabla.appendChild(fila);
      calcularTotales();
    }

    function limpiarTabla() {
      document.querySelector("#tablaItems tbody").innerHTML = "";
      calcularTotales();
    }

    function calcularTotales() {
      let subtotal = 0;
      document.querySelectorAll("#tablaItems tbody tr").forEach(fila => {
        let cantidad = parseFloat(fila.children[0].children[0].value) || 0;
        let unitario = parseFloat(fila.children[2].children[0].value) || 0;
        let total = cantidad * unitario;
        fila.querySelector(".totalFila").innerText = formatoCOP(total);
        subtotal += total;
      });
      document.getElementById("subtotal").innerText = formatoCOP(subtotal);
      let iva = parseFloat(document.getElementById("iva").value) || 0;
      let total = subtotal * (1 + iva/100);
      document.getElementById("total").innerText = formatoCOP(total);
    }

    async function generarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Logo
      if (typeof LOGO_NEMOC !== 'undefined') {
        doc.addImage(LOGO_NEMOC, "PNG", 150, 10, 40, 30);
      }

      doc.setFontSize(16);
      doc.text("COTIZACI√ìN", 14, 20);
      doc.setFontSize(10);
      doc.text("NEMOC Ingenier√≠a y Tecnolog√≠a", 14, 28);
      doc.text("Tel: 3185621097", 14, 34);
      doc.text("Email: nemoca1004@gmail.com", 14, 40);
      doc.text("Direcci√≥n: Calle 45 #35-36, Barrio L√≠bano, Santa Marta", 14, 46);

      // Cliente
      doc.text("Cliente: " + document.getElementById("cliente_nombre").value, 14, 58);
      doc.text("NIT: " + document.getElementById("cliente_nit").value, 14, 64);
      doc.text("Tel√©fono: " + document.getElementById("cliente_tel").value, 14, 70);
      doc.text("Correo: " + document.getElementById("cliente_correo").value, 14, 76);

      // Tabla
      const filas = [];
      document.querySelectorAll("#tablaItems tbody tr").forEach(fila => {
        filas.push([
          fila.children[0].children[0].value,
          fila.children[1].children[0].value,
          formatoCOP(fila.children[2].children[0].value),
          fila.querySelector(".totalFila").innerText
        ]);
      });

      doc.autoTable({
        head: [["Cantidad", "Descripci√≥n", "Unitario", "Total"]],
        body: filas,
        startY: 90
      });

      let finalY = doc.lastAutoTable.finalY + 10;
      doc.text("Subtotal: " + document.getElementById("subtotal").innerText, 14, finalY);
      doc.text("IVA (" + document.getElementById("iva").value + "%):", 14, finalY + 6);
      doc.text("Total: " + document.getElementById("total").innerText, 14, finalY + 12);

      // Condiciones
      doc.setFontSize(12);
      doc.text("Condiciones:", 14, finalY + 24);
      doc.setFontSize(10);
      doc.text(doc.splitTextToSize(document.getElementById("condiciones").value, 180), 14, finalY + 30);

      doc.save("cotizacion_nemoc.pdf");
    }
  </script>
</body>
</html>
